<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="Generator" content="Kate, the KDE Advanced Text Editor" />
<title>led_onoff.asm</title>
</head>
<!-- Highlighting: "Asm6502" -->
<body>
<pre style='color:#8e44ad;background-color:#232629;'>
<span style='color:#7a7c7d;'>;name:            led_onoff.asm</span>
<span style='color:#7a7c7d;'>;assemble:        avra led_onoff.asm</span>
<span style='color:#7a7c7d;'>;flash:           avrdude -c arduino -p m328p -P /dev/ttyACM0 -b 115200 -U flash:w:led_onoff.hex</span>
<span style='color:#7a7c7d;'>;description:     Turns the LED at PB5 (digital out 13) on and after a delay of 2 seconds off again.</span>
<span style='color:#7a7c7d;'>;inspir(at)ed by: http://www.rjhcoding.com/avr-asm-led-blink.php</span>
<span style='color:#7a7c7d;'>;nov 5, 2021 - agguro - no-license license</span>

<span style='color:#2980b9;'>.</span><span style='color:#2980b9;'>device</span><span style='color:#cfcfc2;'> ATmega328P</span>
<span style='color:#2980b9;'>.</span><span style='color:#2980b9;'>cseg</span>
<span style='color:#2980b9;'>.org</span><span style='color:#cfcfc2;'> </span><span style='color:#f67400;'>0</span><span style='color:#cfcfc2;'>x00</span>

start:
<span style='color:#cfcfc2;'>    </span><b><span style='color:#cfcfc2;'>ldi</span></b><span style='color:#cfcfc2;'>     r16</span><span style='color:#3f8058;'>,</span><span style='color:#f67400;'>0</span><span style='color:#cfcfc2;'>b00100000 </span><span style='color:#7a7c7d;'>;r16 = 0x20 PB5 as output</span>
<span style='color:#cfcfc2;'>    </span><b><span style='color:#cfcfc2;'>out</span></b><span style='color:#cfcfc2;'>     </span><span style='color:#f67400;'>0</span><span style='color:#cfcfc2;'>x04</span><span style='color:#3f8058;'>,</span><span style='color:#cfcfc2;'>r16       </span><span style='color:#7a7c7d;'>;r16 to DDRB (0x04) controls PORTB's in/out state.</span>
<span style='color:#cfcfc2;'>    </span><span style='color:#7a7c7d;'>;we can re-use the value 00100000 in r16 so</span>
<span style='color:#cfcfc2;'>    </span><span style='color:#7a7c7d;'>;turn led ON</span>
<span style='color:#cfcfc2;'>    </span><b><span style='color:#cfcfc2;'>out</span></b><span style='color:#cfcfc2;'>     </span><span style='color:#f67400;'>0</span><span style='color:#cfcfc2;'>x05</span><span style='color:#3f8058;'>,</span><span style='color:#cfcfc2;'>r16       </span><span style='color:#7a7c7d;'>;set PORTB with values from r16, pin 13 = high    </span>
<span style='color:#cfcfc2;'>    </span><b><span style='color:#cfcfc2;'>call</span></b><span style='color:#cfcfc2;'>    delay           </span><span style='color:#7a7c7d;'>;wait 1 secs</span>
<span style='color:#cfcfc2;'>    </span><span style='color:#7a7c7d;'>;turn led OFF</span>
<span style='color:#cfcfc2;'>    </span><b><span style='color:#cfcfc2;'>ldi</span></b><span style='color:#cfcfc2;'>     r16</span><span style='color:#3f8058;'>,</span><span style='color:#f67400;'>0</span><span style='color:#cfcfc2;'>b00000000  </span><span style='color:#7a7c7d;'>;r16 = 0b00000000</span>
<span style='color:#cfcfc2;'>    </span><b><span style='color:#cfcfc2;'>out</span></b><span style='color:#cfcfc2;'>     </span><span style='color:#f67400;'>0</span><span style='color:#cfcfc2;'>x05</span><span style='color:#3f8058;'>,</span><span style='color:#cfcfc2;'>r16        </span><span style='color:#7a7c7d;'>;set PORTB with values from r16, pin 13 = low</span>
<span style='color:#cfcfc2;'>    </span>
loop:<span style='color:#cfcfc2;'>    </span>
<span style='color:#cfcfc2;'>    </span><b><span style='color:#fdbc4b;'>jmp</span></b><span style='color:#cfcfc2;'>     loop</span>

<span style='color:#7a7c7d;'>;Assembly code auto-generated by utility from Bret Mulvey</span>
<span style='color:#7a7c7d;'>;Delay 31 999 991 cycles 1s 999ms 999us 437 1/2 ns at 16.0 MHz</span>
<span style='color:#7a7c7d;'>;http://darcy.rsgc.on.ca/ACES/TEI4M/AVRdelay.html</span>
delay:
<span style='color:#cfcfc2;'>    </span><b><span style='color:#cfcfc2;'>ldi</span></b><span style='color:#cfcfc2;'>     r18</span><span style='color:#3f8058;'>,</span><span style='color:#cfcfc2;'> </span><span style='color:#f67400;'>82</span>
<span style='color:#cfcfc2;'>    </span><b><span style='color:#cfcfc2;'>ldi</span></b><span style='color:#cfcfc2;'>     r19</span><span style='color:#3f8058;'>,</span><span style='color:#cfcfc2;'> </span><span style='color:#f67400;'>43</span>
<span style='color:#cfcfc2;'>    </span><b><span style='color:#cfcfc2;'>ldi</span></b><span style='color:#cfcfc2;'>     r20</span><span style='color:#3f8058;'>,</span><span style='color:#cfcfc2;'> </span><span style='color:#f67400;'>254</span>
l1:<span style='color:#cfcfc2;'> </span>
<span style='color:#cfcfc2;'>    </span><b><span style='color:#cfcfc2;'>dec</span></b><span style='color:#cfcfc2;'>     r20</span>
<span style='color:#cfcfc2;'>    </span><b><span style='color:#cfcfc2;'>brne</span></b><span style='color:#cfcfc2;'>    l1</span>
<span style='color:#cfcfc2;'>    </span><b><span style='color:#cfcfc2;'>dec</span></b><span style='color:#cfcfc2;'>     r19</span>
<span style='color:#cfcfc2;'>    </span><b><span style='color:#cfcfc2;'>brne</span></b><span style='color:#cfcfc2;'>    l1</span>
<span style='color:#cfcfc2;'>    </span><b><span style='color:#cfcfc2;'>dec</span></b><span style='color:#cfcfc2;'>     r18</span>
<span style='color:#cfcfc2;'>    </span><b><span style='color:#cfcfc2;'>brne</span></b><span style='color:#cfcfc2;'>    l1</span>
<span style='color:#cfcfc2;'>    </span><b><span style='color:#cfcfc2;'>nop</span></b>
<span style='color:#cfcfc2;'>    </span><b><span style='color:#cfcfc2;'>ret</span></b></pre>
</body>
</html>
