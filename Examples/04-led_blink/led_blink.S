;name:        led_blink.S
;description: let the LED, connected to PINB5 on PORTB, blink (endlessly)
;build:       make flash

#define    DDRB  0x04
#define    PORTB 0x05
#define    PINB5 5

.section .text
.global main

main:
    sbi     DDRB, PINB5             ;set pin 5 of DDRB register HIGH
    ldi     r16,(1 << PINB5)        ;set pin 5 of PORTB HIGH
    mov     r17,r16                 ;copy r16 to r17, r17 is used as a mask
    
loop:

    out     PORTB,r16               ;LED on
    
;Assembly code auto-generated by utility from Bret Mulvey
;Delay 31 999 991 cycles 1s 999ms 999us 437 1/2 ns at 16.0 MHz
;http://darcy.rsgc.on.ca/ACES/TEI4M/AVRdelay.html
    
    ldi     r18, 82
    ldi     r19, 43
    ldi     r20, 254
l1: 
    dec     r20
    brne    l1
    dec     r19
    brne    l1
    dec     r18
    brne    l1
    
    eor     r16, r17                ;toggle pin 5 of PORTB
    
    rjmp     loop

.end
