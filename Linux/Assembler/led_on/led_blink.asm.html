<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="Generator" content="Kate, the KDE Advanced Text Editor" />
<title>led_blink.asm</title>
</head>
<!-- Highlighting: "AVR Assembler" -->
<body>
<pre style='color:#cfcfc2;background-color:#232629;'>
<span style='color:#7a7c7d;'>;name:            led_blink.asm</span>
<span style='color:#7a7c7d;'>;assemble:        avra led_blink.asm</span>
<span style='color:#7a7c7d;'>;flash:           avrdude -p m328p -c stk500v1 -b 57600 -P /dev/ttyACM0 -U flash:w:led_blink.hex</span>
<span style='color:#7a7c7d;'>;description:     Toggles PB5 (led at pin 13) constantly on and of with a 4secs delay.</span>
<span style='color:#7a7c7d;'>;inspir(at)ed by: http://www.rjhcoding.com/avr-asm-led-blink.php</span>
<span style='color:#7a7c7d;'>;nov 5, 2021 - agguro - no-license license</span>

<b>.cseg</b>
<b>.org</b> <span style='color:#f67400;'>0x00</span>

<span style='color:#8e44ad;'>start:</span>
    <b>ldi</b>     r22<span style='color:#3f8058;'>,</span><span style='color:#f67400;'>0b00100000</span>  
    <b>ldi</b>     r16<span style='color:#3f8058;'>,</span><span style='color:#f67400;'>0b00100000</span>  <span style='color:#7a7c7d;'>;r16 = 0x20 PB5 as output</span>
    <b>out</b>     <span style='color:#f67400;'>0x04</span><span style='color:#3f8058;'>,</span>r16        <span style='color:#7a7c7d;'>;r16 to DDRB (0x04) controls PORTB's in/out state.</span>
    <span style='color:#7a7c7d;'>;re-use r16 = 0x00100000 to set PB5 high (the famous pin 13 on Arduino Uno Rev3)</span>
<span style='color:#8e44ad;'>loop:</span>
    <b>out</b>     <span style='color:#f67400;'>0x05</span><span style='color:#3f8058;'>,</span>r16        <span style='color:#7a7c7d;'>;set PORTB with values from r16, pin 13 = low</span>
    <b><span style='color:#fdbc4b;'>call</span></b>    delay
    
    <b>eor</b>     r16<span style='color:#3f8058;'>,</span>r22         <span style='color:#7a7c7d;'>;toggle bit PB5</span>
    <b><span style='color:#fdbc4b;'>jmp</span></b>     loop
    
    

<span style='color:#7a7c7d;'>;Assembly code auto-generated by utility from Bret Mulvey</span>
<span style='color:#7a7c7d;'>;Delay 79 999 991 cycles 4s 999ms 999us 437 1/2 ns at 16.0 MHz</span>
<span style='color:#7a7c7d;'>;http://darcy.rsgc.on.ca/ACES/TEI4M/AVRdelay.html</span>
<span style='color:#8e44ad;'>delay:</span>
    <b>ldi</b>  r18<span style='color:#3f8058;'>,</span> <span style='color:#f67400;'>2</span>
    <b>ldi</b>  r19<span style='color:#3f8058;'>,</span> <span style='color:#f67400;'>150</span>
    <b>ldi</b>  r20<span style='color:#3f8058;'>,</span> <span style='color:#f67400;'>216</span>
    <b>ldi</b>  r21<span style='color:#3f8058;'>,</span> <span style='color:#f67400;'>6</span>
<span style='color:#8e44ad;'>l1:</span>
    <b>dec</b>  r21
    <b><span style='color:#fdbc4b;'>brne</span></b> l1
    <b>dec</b>  r20
    <b><span style='color:#fdbc4b;'>brne</span></b> l1
    <b>dec</b>  r19
    <b><span style='color:#fdbc4b;'>brne</span></b> l1
    <b>dec</b>  r18
    <b><span style='color:#fdbc4b;'>brne</span></b> l1
    <b><span style='color:#fdbc4b;'>rjmp</span></b> PC<span style='color:#3f8058;'>+</span><span style='color:#f67400;'>1</span>
    <b><span style='color:#fdbc4b;'>ret</span></b>
</pre>
</body>
</html>
