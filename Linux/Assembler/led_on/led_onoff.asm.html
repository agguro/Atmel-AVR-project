<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="Generator" content="Kate, the KDE Advanced Text Editor" />
<title>led_onoff.asm</title>
</head>
<!-- Highlighting: "AVR Assembler" -->
<body>
<pre style='color:#cfcfc2;background-color:#232629;'>
<span style='color:#7a7c7d;'>;name:            led_onoff.asm</span>
<span style='color:#7a7c7d;'>;assemble:        avra led_onoff.asm</span>
<span style='color:#7a7c7d;'>;flash:           avrdude -p m328p -c stk500v1 -b 57600 -P /dev/ttyACM0 -U flash:w:led_onoff.hex</span>
<span style='color:#7a7c7d;'>;description:     Turns the LED at PB5 (digital out 13) on and after a delay of 2 seconds off again.</span>
<span style='color:#7a7c7d;'>;inspir(at)ed by: http://www.rjhcoding.com/avr-asm-led-blink.php</span>
<span style='color:#7a7c7d;'>;nov 5, 2021 - agguro - no-license license</span>

<b>.cseg</b>
<b>.org</b>	<span style='color:#f67400;'>0x00</span>

<span style='color:#8e44ad;'>start:</span>
    <b>ldi</b>      r16<span style='color:#3f8058;'>,</span><span style='color:#f67400;'>0b00100000</span> <span style='color:#7a7c7d;'>;r16 = 0x20 PB5 as output</span>
    <b>out</b>      <span style='color:#f67400;'>0x04</span><span style='color:#3f8058;'>,</span>r16       <span style='color:#7a7c7d;'>;r16 to DDRB (0x04) controls PORTB's in/out state.</span>
    <span style='color:#7a7c7d;'>;we can re-use the value 00100000 in r16 so</span>
    <span style='color:#7a7c7d;'>;turn led ON</span>
    <b>out</b>      <span style='color:#f67400;'>0x05</span><span style='color:#3f8058;'>,</span>r16       <span style='color:#7a7c7d;'>;set PORTB with values from r16, pin 13 = high    </span>
    <span style='color:#7a7c7d;'>;wait 2 secs</span>
    <b><span style='color:#fdbc4b;'>call</span></b>    delay

    <span style='color:#7a7c7d;'>;turn led OFF</span>
    <b>ldi</b>     r16<span style='color:#3f8058;'>,</span><span style='color:#f67400;'>0b00000000</span>  <span style='color:#7a7c7d;'>;r16 = 0b00000000</span>
    <b>out</b>     <span style='color:#f67400;'>0x05</span><span style='color:#3f8058;'>,</span>r16        <span style='color:#7a7c7d;'>;set PORTB with values from r16, pin 13 = low</span>
    
<span style='color:#8e44ad;'>loop:</span>    
    <b><span style='color:#fdbc4b;'>jmp</span></b>     loop

<span style='color:#7a7c7d;'>;Assembly code auto-generated by utility from Bret Mulvey</span>
<span style='color:#7a7c7d;'>;Delay 31 999 991 cycles 1s 999ms 999us 437 1/2 ns at 16.0 MHz</span>
<span style='color:#7a7c7d;'>;http://darcy.rsgc.on.ca/ACES/TEI4M/AVRdelay.html</span>
<span style='color:#8e44ad;'>delay:</span>
    <b>ldi</b>     r18<span style='color:#3f8058;'>,</span> <span style='color:#f67400;'>82</span>
    <b>ldi</b>     r19<span style='color:#3f8058;'>,</span> <span style='color:#f67400;'>43</span>
    <b>ldi</b>     r20<span style='color:#3f8058;'>,</span> <span style='color:#f67400;'>254</span>
<span style='color:#8e44ad;'>l1:</span> 
    <b>dec</b>     r20
    <b><span style='color:#fdbc4b;'>brne</span></b>    l1
    <b>dec</b>     r19
    <b><span style='color:#fdbc4b;'>brne</span></b>    l1
    <b>dec</b>     r18
    <b><span style='color:#fdbc4b;'>brne</span></b>    l1
    <b>nop</b>
    <b><span style='color:#fdbc4b;'>ret</span></b>
</pre>
</body>
</html>
